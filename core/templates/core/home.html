{% extends "base.html" %}

{% block title %}Inicio · Juegos{% endblock %}

{% block content %}
<section class="text-center mb-4">
  <h1 class="display-5 fw-bold">Juegos Django</h1>
  <p class="lead">Genera y exporta actividades imprimibles</p>
  <form class="d-flex justify-content-center" method="get">
    <input type="search" name="q" value="{{ query }}" class="form-control w-auto" placeholder="Buscar por tipo">
    <button class="btn btn-primary ms-2" type="submit">Buscar</button>
  </form>
</section>

{# Estadísticas por tipo (si existen) #}
{% if total_por_tipo %}
<div class="mb-4 d-flex flex-wrap gap-2 justify-content-center">
  {% for stat in total_por_tipo %}
    <span class="badge bg-secondary">{{ stat.tipo }}: {{ stat.n }}</span>
  {% endfor %}
</div>
{% endif %}

{# Tarjetas de acceso a los juegos #}
<div class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 g-4 mb-5">
  {% if cards %}
    {% for card in cards %}
    <div class="col">
      <div class="card h-100 text-center">
        <div class="card-body d-flex flex-column">
          {% if card.icon %}<i class="bi {{ card.icon }} display-6 mb-2"></i>{% endif %}
          <h5 class="card-title">{{ card.name }}</h5>
          {% if card.desc %}<p class="card-text">{{ card.desc }}</p>{% endif %}
          <a href="{{ card.url }}" class="btn btn-primary mt-auto">Abrir</a>
        </div>
      </div>
    </div>
    {% endfor %}
  {% elif games %}
    {# Compatibilidad con el contexto antiguo de 'main' #}
    {% for name, url in games %}
    <div class="col">
      <div class="card h-100">
        <div class="card-body text-center">
          <a href="{{ url }}" class="stretched-link text-decoration-none">{{ name }}</a>
        </div>
      </div>
    </div>
    {% endfor %}
  {% endif %}
</div>

{# Últimos generados (si existen) #}
{% if recientes is not None %}
<h2 class="h4">Últimos generados</h2>
<table class="table table-sm">
  <thead>
    <tr><th>Tipo</th><th>Fecha</th><th></th></tr>
  </thead>
  <tbody>
    {% if recientes %}
      {% for item in recientes %}
      <tr>
        <td>{{ item.obj.tipo }}</td>
        <td>{{ item.obj.created_at|date:"Y-m-d H:i" }}</td>
        <td><a href="{{ item.url }}" class="btn btn-outline-primary btn-sm">Ver</a></td>
      </tr>
      {% endfor %}
    {% else %}
      <tr><td colspan="3" class="text-center">Sin resultados</td></tr>
    {% endif %}
  </tbody>
</table>
{% endif %}
{% endblock %}
